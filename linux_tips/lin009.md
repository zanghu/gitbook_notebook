## Linux: sudo运行程序搜索路径发生变化的研究

### 1.问题描述

在使用docker时，需要安装docker-compose，官方指南要求执行如下命令：

```shell
sudo curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose
```

然而很不幸返回报错：curl: \(1\) Protocol "https" not supported or disabled in libcurl

![](/assets/lonux009-1.png)

大致意思是目前安装的curl不支持https协议，但是本地安装的curl-7.59.0在bianyishi在编译时已经关联了openssl，理论上不可能出现这种情况。

### 2.原因判定

首先，重新编译安装curl，结果无效，仍然出现之前的错误。

其次，不使用sudo命令，执行

```shell
curl -L https://www.baidu.com/
```

返回正常结果，但是如果在上面的命令前面加上sudo就会报错：curl: \(1\) Protocol "https" not supported or disabled in libcurl

于是怀疑sudo下执行的curl和非sudo下执行的curl不是一个程序。

为了证明猜想，分别执行：curl --version 和 sudo curl --version，结果如下：

![](/assets/linux009-2.png)

果然，sudo命令下执行的curl和自己安装的curl不是同一个程序。经检查，sudo执行的是/usr/local/bin下的curl程序。

### 3.原因分析

Take a look at /etc/sudoers. The default file in Fedora (as well as in RHEL, and also Ubuntu and similar) includes this line:
```shell
...
Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin
...
```
Which ensures that your path is clean when running binaries under sudo. This helps protect against some of the concerns noted in this question. It's also convenient if you don't have /sbin and /usr/sbin in your own path.
