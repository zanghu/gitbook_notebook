## Pytorch: 难懂函数——torch.gather

参考资料：[http://www.cnblogs.com/darkknightzh/p/6836568.html](http://www.cnblogs.com/darkknightzh/p/6836568.html)

torch.gather函数的官方文档中解释比较复杂，而例子有关于简单

### 1.torch.gather的作用

其实从torch.gather子啊官方文档中的例子可以看出，其功能是用于对torch.Tensor类对象进行一类受限的元素置换。

numpy中因该也有的元素置换函数有，但尚未找到（`numpy.transpose`是轴置换函数，并非元素置换）。

### 2.张量置换的分析

#### 2.1 描述张量置换的充要条件

要描述一个张量置换，至少需要下面两个张量：

（1）原张量，即用来**被**置换的那个“模板”张量，置换后得到的张量的每个元素都来自于原张量；

（2）索引张量：即描述置换的映射关系的那个张量，索引张量的每个元素是一个索引号，一般用来表示置换后张量中的一个元素对应于原张量中的那哪个元素；

#### 2.2 简单张量元素置换的分析

* 最简单的情况

首先考虑低维张量，以向量（一维张量）为例进行分析。

要描述对一个向量进行置换得到一个新的向量，所需的索引张量也是一个向量，例如：

原张量为: \[1, 2, 3\]，索引张量为\[2, 0, 1\]，那么置换后的张量为\[3, 1, 2\]

* 稍复杂的情况

接下来考虑原张量是矩阵（二维张量）的情况，如果希望将原矩阵通过元素置换办得到一个新矩阵，那么为了标明新矩阵每个元素在原矩阵的位置，必须为新矩阵每个位置上元素一个二元坐标，这个坐标就是新矩该位置元素在原矩阵中的行号和列号。

于是，索引矩阵形如

```sehll
# 下面矩阵每个元素是一个二元组
[(x11, y11), (x12, y12)
 (2221, y21), (x22, y22)]
```

于是得到结论，对于二位张量置换的情况，索引矩阵是一个三维张量。

* 更一般的情况

不难将上面对一维、二维张量置换的分析推广到三维置换和更一般的N维置换中，不难想象，这时的索引张量是一个M+1维的张量（M是置换后得到的张量的维数），其详细结构为：

整体是一个N维张量，每个元素是一个N元向量（注意和标量区分）。

准确地描述N维张量置换的索引矩阵：

将一个形状（shape）为(x1, x2, ... xN)的N维张量置换为一个形状是(y1, y2, ..., yM)的M维张量，所需的索引矩阵是一个形状是（y1, y2, ..., yM, N)的M+1维张量。

### 3.torch.gather参数说明

* 函数原型

`torch.gather(input, dim, index, out=None) → Tensor`

* 参数说明

input: torch.Tensor, 作为置换“基础”的原张量，被置换的一方

dim: 置换切面所垂直的轴向的索引号

