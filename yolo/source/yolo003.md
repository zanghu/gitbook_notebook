## Yolo v3: 源码分析——数据配置文件与数据加载

参考资料：[https://pjreddie.com/darknet/yolo/](https://pjreddie.com/darknet/yolo/)

### 1.两个配置文件

YOLO各版本一直以来都使用两个（类）配置文件：

- 数据配置文件：用于指明样本和真值信息的位置，模型参数保存路径和模型输出结果保存路径等。

- 网络结构配置文件: 指明网络的整体结构、优化算法和每一层的结构

#### 1.1.数据配置文件

数据配置文件有以下特点：

- 数据配置文件内容相对较少。

- 数据配置文件推荐以`.data`作为数据配置文件的后缀名，例如：YOLOv3的训练配置文件`voc.data`和ctw-baseline的`chinese.data`。

- 数据配置文件不包含以下内容：（1）预处理、样本增强、batch大小相关的信息；（2）不直接包含样本真值信息的路径（darknet默认样本图片路径与对应的真值信息文件的路径存在映射规则，训练时根据该规则有样本图片路径推断真值信息文件路径）；（3）不包含样本尺寸相关的信息（darknet的样本图片加载模块可以直接）

### 2.数据加载模块和数据格式

机器学习模型的训练数据一般都要经过各种加工处理之后，才能制作成符合模型要求的输入数据格式。对于图片数据，各种预处理（缩放、像素值归一化等）和样本增强（平移、翻转、裁剪等等）也是必不可少的。

在`darknet`中，数据加工分为两部分：

- **STEP 1**: 由原始数据集生成符合darknet要求的格式的训练样本和真值信息，这步由`darknet`用户负责实现。

- **STEP 2**: 有输入数据生成内存中的模型输入数据，这步由`draknet`的数据加载器负责完成。

#### 2.1.从原始数据集到darknet输入数据文件

这部分包括：
（1）将训练样本图片和真值信息文件按照指定目录格式和命名方式放置；
（2）确保样本图片的后缀名是`darknet`支持的格式；
（3）生成每个训练样本的真值信息文件；



（1）图片样本格式

（2）真值信息文件格式

#### 2.2.数据加载模块


#### 2.3.内存数据格式

内存数据格式是指经过darknet的数据加载模块加载到内存中，准备输入给为网络的第一层的（内存中）数据格式。

（1）图片样本格式: 容器，轴向，取值（[0-1]浮点数），预处理流程。

（2）真值信息格式：bbox表示方式（中心坐标长宽），相对坐标，每个文件说明一个样本，文件每行五个数说明一个bbox。真值信息也按照样本增强的方式进行了必要的变换。

