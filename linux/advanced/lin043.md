## Linux: 内存管理机制简析

参考资料：

\[1\] [linux free 命令用法说明](https://www.imooc.com/article/26314)

\[2\] [windows和linux的内存管理](https://www.cnblogs.com/dartagnan/archive/2011/06/15/2126880.html)

\[3\] 《Linux高性能服务器编程（第3版）》，CH1

### 1.查看Linux系统当前内存使用情况

* 方法一：使用`free`命令粗略查看

```shell
$ free -m # 以MB为单位
```

或者用用户更易读的格式显示

```shell
$ free -h # 并不是所有系统的free都支持-m参数, Ubuntu支持，但SUSE Linux下就没有该参数
```

终端输出结果：
```shell
(base) zanghu@ubuntu:~$ free -h
              total        used        free      shared  buff/cache   available
Mem:           7.8G        1.4G        4.9G         18M        1.4G        6.1G
Swap:          2.0G          0B        2.0G
```

**注意**：`free`和`avilable`的区别：
`free`: 当前物理内存中没有被使用的那部分内存；
`avalable`: 对于用户程序而言的当前最大可用内存; 
一般来说，`free` < `avilable`，原因是当前内存必然有一部分被系统作为页缓冲（或其他缓冲）称之为`buf/cache`，这部分内存是不被计算在`free`中的。但是当内存紧张的情况下，系统可以通过释放一部分`buf/cache`的空间作为程序空间。因此`avilable`其实是`free` + 可释放的`buf/cache`空间之和。当然这只是理论值，实际上该公式比较粗略并不非常准确。

* 方法二：通过/proc/meminfo查看明细

详细查看的方法：

```shell
$ cat /proc/meminfo
```

执行结果：

```shell
(base) zanghu@ubuntu:~$ cat /proc/meminfo
MemTotal:        8144236 kB
MemFree:         5117600 kB
MemAvailable:    6316988 kB
Buffers:          156652 kB
Cached:          1204996 kB
SwapCached:            0 kB
Active:          1581956 kB
Inactive:         729816 kB
Active(anon):     951464 kB
Inactive(anon):    17556 kB
Active(file):     630492 kB
Inactive(file):   712260 kB
Unevictable:          16 kB
Mlocked:              16 kB
SwapTotal:       2097148 kB
SwapFree:        2097148 kB
Dirty:               956 kB
Writeback:             0 kB
AnonPages:        950188 kB
Mapped:           287076 kB
Shmem:             18884 kB
Slab:             217368 kB
SReclaimable:     155212 kB
SUnreclaim:        62156 kB
KernelStack:       11392 kB
PageTables:        42608 kB
NFS_Unstable:          0 kB
Bounce:                0 kB
WritebackTmp:          0 kB
CommitLimit:     6169264 kB
Committed_AS:    4732056 kB
VmallocTotal:   34359738367 kB
VmallocUsed:           0 kB
VmallocChunk:          0 kB
HardwareCorrupted:     0 kB
AnonHugePages:         0 kB
ShmemHugePages:        0 kB
ShmemPmdMapped:        0 kB
CmaTotal:              0 kB
CmaFree:               0 kB
HugePages_Total:       0
HugePages_Free:        0
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
Hugetlb:               0 kB
DirectMap4k:      175936 kB
DirectMap2M:     6115328 kB
DirectMap1G:     4194304 kB
```