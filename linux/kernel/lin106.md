## 并发编程：并发所导致的问题的来源分析

### 参考资料

CSDN：[谈乱序执行和内存屏障](https://blog.csdn.net/dd864140130/article/details/56494925)

CSDN: [原子操作,内存屏障,锁](https://blog.csdn.net/youyou1543724847/article/details/85050581)

### 1.并发所导致的问题的来源

并发导致问题的来源包括：

#### 原因一：并发

多线程并发

多进程并发

#### 原因二：存储器数据不一致

引发存储器数据数据不一致问题的原因包括：

（1）主存和高速缓存数据不一致；
（2）多级缓存之间数据不一致；
（3）多核CPU不同核的缓存之间数据不一致

#### 原因三：指令重排

可能发生乱序执行的情况:

* 现代处理器采用指令并行技术,在不存在数据依赖性的前提下,处理器可以改变语句对应的机器指令的执行顺序来提高处理器执行速度
* 现代处理器采用内部缓存技术,导致数据的变化不能及时反映在主存所带来的乱序.
* 现代编译器为优化而重新安排语句的执行顺序

其中前两种都属于CPU进行的，属于运行期（动态）指令重排；后一种石编译器进行的，属于编译期（静态）指令重排。

### 2.以上问题的解决方案

* 内存屏障

* 原子操作

* 锁

原理：

CPU提供了原子操作、关中断、锁内存总线,内存屏障等机制；OS基于这几个CPU硬件机制，就能够实现锁；

再基于锁，就能够实现各种各样的同步机制（信号量、消息、Barrier等等等等）。

所有的同步操作最基础的理论就是原子操作。内存屏障,锁都是为了保证在不同的平台或者是CPU类型下的原子操作。

原子操作在单核，单线程/无中断，且编译器不优化的情况下是确定的，是按照C/C++代码顺序执行的，所以不存在异步问题





