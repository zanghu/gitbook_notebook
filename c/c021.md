## C: 返回值是函数指针的函数的定义的正确写法

本文源于《UNIX环境高级编程（第三版）》（APUE）一书10.3节开头部分。

一般程序设计中，很少见到函数的返回值是一个函数指针类型，偶然在学习《UNIX环境高级编程（第三版）》的信号（Signal）相关章节中偶然看到此类函数，在此记下。

### 1.以signal函数为例

UNIX信号机制的最简单函数`signal`

**函数原型**：

```c
#include <signal.h>

void (*signal(int signo, void (*func)(int)))(int);
```

`signal`函数原型说明此函数要求两个参数，返回值是一个函数指针，该指针所指向的函数无返回值（void）。

**输入参数**：

参数1：是一个整型数

参数2：是一个输入参数是整型数、无返回值的函数指针

**返回值**：

返回值：类型为void (*)(int)的函数指针

**函数原型（简化版）**

APUE中指出，上述函数原型有些复杂，可以使用如下等价定义，使其简单一些：

```c
// 定义返回值类型别名
typedef void Sigfunc(int);

// 简化版signal函数定义
Sigfunc *signal(int, Sigfunc *);
```

### 2.整型数宏定义伪装成函数指针

系统头文件`<signal.h>`中常见以下声明：

```c
#define SIG_ERR (void (*)())-1
#define SIG_DFL (void (*)())0
#define SIG_IGN (void (*)())1
```

以宏定义`SIG_ERR`为例，这里其实是

（1）先利用整型数和指针之间的强制类型转换，将-1强制转化为一个void (*)()指针；
（2）再将宏`SIG_ERR`定义为该函数指针。

这样就定义了一个“伪”函数指针返回值，所谓“伪”是因为该函数指针其实指向的的是无效（但也许是系统默认的）的函数地址。

### 3.原书截图

* 截图1

![](/assets/c021_001.PNG)

* 截图2

![](/assets/c021_002.PNG)

