## C: callgrind性能测试工具

### 1.概述

`GNU GCC`有自带的程序性能分析工具`gprof`，但是该工具存在很多不便于使用的缺陷：

* 需要重新编译程序，增加编译参数`-pg`后边溢出的程序才能用于分析性能；
* 程序所依赖的所有源码、库文件都需要加上`-pg`后重新编译，对于C运行时库glibc则需要下载专门的版本；
* 实践中动态库无法进行分析（也许是因为我没有正确操作）；

因此，`valgrind`工具套件中提供的`callgrind`运行性能分析工具就显得格外有价值：不需要修改程序编译指令，也就不需要重新编译程序，具有良好的易用性。

需要注意的是，使用`callgrind`检查程序运行后输出的数据文件不适合直接阅读，需要用专用工具解析为图表的形式。

### 2.使用方法

`callgrind`的使用方法比同属于`valgrind`工具集的`memcheck`和`helgrind`要复杂不少。

#### Step 1: 使用`callgrind`运行程序

执行下列命令，运行结束后会，当前目录下会生成名为`callgrind.out.进程号`的性能测试结果数据文件。

* **基本命令**

```shell
$ valgrind --tool=callgrind ./<可执行文件名称>
```

* **每个线程导出单独数据文件**

```shell
$ valgrind --tool=callgrind --separate-threads=yes ./<可执行文件名称>
```

#### Step 2: 将callgrind输出文件可视化

* **Linux环境下使用`gprof2dot`工具**

`gprof2dot`支持将gprof、callgrind等性能测试工具导出的数据文件转化为