## C: 基于libcurl进行http通讯

`curl`广泛应用于Linux shell和PHP中的HTTP通讯。

### 1.组装http post请求body

```c
char *http_req_body = ...; // http请求报文body
curl_easy_setopt(curl, CURLOPT_POSTFIELDS, http_req_body); // 设置POST请求报文体
...
res = curl_easy_perform(curl); // 进行http通讯
```

### 2.接收HTTP响应body

接收并处理HTTP POST请求的响应，在\`libcurl\`中是通过提供**回调函数**和回调函数操作的参数实现的。

- 回调函数操作的用来保存返回报文的数据空间结构体定义：

```c

```

- 用于返回报文处理的回调函数的一个例子：将请求保存到用户提供的数据缓冲区

```c
struct DynamicBuffer
{
    char *data;
    size_t len;
    size_t size;
};


// 将HTTP返回报文的body写入到struct DynamicBuffer的回调函数
size_t body_callback(char *ptr, size_t size, size_t nmemb, void *userdata)
{
    size_t total = size * nmemb;
    struct DynamicBuffer *buf = (struct DynamicBuffer *)userdata;
    CHECK_ERROR_CODE(writeDynamicBuffer(buf, ptr, total), ESB004_VAR_VAL_LOGIC_ERR);

    return total;
}
```

- 处理返回报文的代码示例：

```c
struct DynamicBuffer *body = NULL;
CHK_ERR(createDynamicBuffer(&body));
...
// 设置保存返回报文body的函数和数据
CHK_ERR(curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, body_callback)); // 将返回报文使用body_callback处理
CHK_ERR(curl_easy_setopt(curl, CURLOPT_WRITEDATA, body)); // 提供body_callback的第四个参数
...
res = curl_easy_perform(curl); // 进行http通讯
```

### 2.接收http请求headers

### 3.自定义HTTP请求headers

### 4.获得HTTP请求headers

### 5.全局初始化与全局资源释放



