## C: Linux下send和recv超时


### 1.socket中的超时

socket通讯中最基本的四个可阻塞函数是：`connect`、`send`、`recv`和`accept`，此外在高级通讯中还有`select`和`epoll`相关的一些函数也可以在阻塞模式下运行。

### 2.send和recv中的超时设置

以下代码在Ubuntu和Suse下实测有效

```c
// setsockopt正常返回0，出错返回-1
CHK_ERR(setsockopt(socket，SOL_SOCKET,SO_SNDTIMEO，&timeout,sizeof(struct timeval)));
CHK_ERR(setsockopt(socket，SOL_SOCKET,SO_RCVTIMEO，&timeout,sizeof(struct timeval)));
```

### 3.超时出错实验和分析

#### 3.1.实验设计

* **服务端：**

第一步：socket() -> bind() -> listen()建立服务端；

第二步：accept()阻塞等待客户端连接；

第三步：accept()函数返回（收到客户端请求）后什么也不做，直接`sleep(300)`，故意使客户端操作超时；

* **客户端：**

send()超时：与服务端建立连接后循环发送固定长度（实验中采用16字节消息）的消息直到send()发生错误，打印错误信息。

recv()超时：与服务端建立连接后直接开始接收消息直到recv()发生错误，打印错误信息。

实验中socket均为默认的阻塞模式。

#### 3.2.实验